# Telegram Archive Bot

## Overview

The Telegram Archive Bot is a Telegram bot designed to archive messages, media files, and track edits and deletions in business chats. It stores messages in a SQLite database, saves media files on the server, and sends notifications to the admin about actions such as message edits, deletions, or spam detection. The project includes spam protection, automatic cleanup of old data, and database backups.

## Features

- **Message Archiving**: Stores text, media (photos, videos, documents, voice, and audio messages), and message metadata.
- **Edit and Deletion Tracking**: Records message edits and deletions, preserving original content.
- **Spam Protection**: Restricts media uploads if a user exceeds a threshold (e.g., too many photos in a minute).
- **Admin Notifications**: Sends alerts for message edits, deletions, or spam in the business chat.
- **Automatic Cleanup**: Deletes messages and media older than a specified period (default: 5 days).
- **Database Backup**: Daily backup of the database sent to the admin.
- **Admin Commands**:
  - `/stats`: Displays message statistics (total, deleted, edited, with media).
  - `/size`: Shows the project directory size.
- **Systemd Service**: Optional setup for auto-starting the bot as a systemd service.

## Requirements

- **Operating System**: Ubuntu (recommended 20.04 or later).
- **Python**: Version 3.8 or higher.
- **Python Dependencies**: `requests`, `schedule` (installed automatically).
- **Root Privileges**: Required for installation and systemd service setup.
- **Telegram Bot Token**: Obtain a token via [BotFather](https://t.me/BotFather).
- **Telegram Business Connection**: Required for the bot to operate in a business chat.

## Installation

1. **Clone the Repository**:
   ```bash
   git clone <repository-url>
   cd <repository-directory>
   ```

2. **Make the Install Script Executable**:
   ```bash
   chmod +x install.sh
   ```

3. **Run the Installation**:
   ```bash
   sudo ./install.sh
   ```

   During installation:
   - Provide the Telegram bot token.
   - Configure settings (spam threshold, max file size, cleanup period, etc.).
   - Choose whether to run `init_bot.py` to set up the business connection (recommended: select "y").
   - Decide whether to set up a systemd service for auto-start (recommended: select "y").

4. **Set Up Business Connection** (if skipped during installation):
   ```bash
   cd /opt/telegram-bot
   python3 init_bot.py
   ```
   Follow the console instructions to connect the bot in Telegram.

## Usage

- If using the systemd service:
  - Check status: `sudo systemctl status telegram-bot`
  - Stop/restart: `sudo systemctl stop telegram-bot` or `sudo systemctl restart telegram-bot`
  - View logs: `journalctl -ukeyboard_arrow_right` Logs: `journalctl -u telegram-bot`

- If running manually:
  ```bash
  cd /opt/telegram-bot
  python3 as.py
  ```

- **Directories and Files**:
  - Media files: `/opt/telegram-bot/media_archive/`
  - Database: `/opt/telegram-bot/messages.db`
  - Spam tracker: `/opt/telegram-bot/spam_tracker.json`
  - Configuration: `/opt/telegram-bot/config.py`

- **Admin Commands**:
  Send to the bot’s chat:
  - `/stats` — View message statistics.
  - `/size` — Check the project directory size.

## Configuration

The `config.py` file (generated by the install script) includes:
- `TOKEN`: Telegram bot token.
- `ADMIN_ID`, `ALLOWED_BUSINESS_ID`, `SENDER_USERNAME`: Auto-filled by `init_bot.py`.
- `MEDIA_DIR`: Directory for media storage (default: `media_archive`).
- `MAX_FILE_SIZE`: Maximum file size (default: 50 MB).
- `CLEANUP_DAYS`: Message retention period (default: 5 days).
- `SPAM_THRESHOLD`, `SPAM_WINDOW`, `SPAM_BLOCK_DURATION`: Spam protection settings.

## Logging

- Logs are output to the console (manual run) or systemd journal (`journalctl -u telegram-bot`).
- Notifications for spam, edits, and deletions are sent to the admin via Telegram.

## Troubleshooting

- **Bot not responding**: Verify the token in `config.py` and ensure the business connection is active.
- **Network errors**: The bot automatically retries on connection failures.
- **Systemd issues**: Check service status (`sudo systemctl status telegram-bot`) and logs (`journalctl -u telegram-bot`).
- **Large directory size**: Use the `/size` command and adjust `CLEANUP_DAYS` for more frequent cleanup.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.

## Authors

- **Eg_Rek**
  - Telegram: [t.me/eg_rek](https://t.me/eg_rek)
  - GitHub: [github.com/Eg-rek](https://github.com/Eg-rek)

## Contact

For questions or suggestions, reach out via Telegram: [t.me/eg_rek](https://t.me/eg_rek).
